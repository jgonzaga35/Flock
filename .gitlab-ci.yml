# DO NOT CHANGE THIS FILE!
#
# This is run on a non-standard gitlab runner so any changes you make may break in unexpected ways.
# If you feel for some reason this file MUST be changed, please post on the course forum so it can
# be discussed between you and course staff.
#
image: comp1531/basic:20T3

stages:
  - checks

pytest:
  stage: checks
  script:
    # Generate coverage data at the same time we run the tests
    - coverage run -m pytest --junitxml=pytest_report.xml
    - coverage report
    - coverage html
  coverage: '/TOTAL.*\s+(\d+%)$/'
  artifacts:
    reports:
      junit: pytest_report.xml
    paths:
      - htmlcov/
    expose_as: Coverage Report
    expire_in: 1 week

pylint:
  stage: checks
  script:
    - find . -type f -name "*.py" | xargs pylint

black:
  stage: checks
  script:
    - uname -a
    - wget https://files.pythonhosted.org/packages/c6/d4/0cfc341b58b40ad52b648affc7c1eb6aa75140230dc14e92a39a79706eed/regex-2020.10.11-cp37-cp37m-manylinux2010_x86_64.whl
    - pip install ./regex-2020.10.11-cp37-cp37m-manylinux2010_x86_64.whl
    - pip3 install black
    - python3 -m black --check .
